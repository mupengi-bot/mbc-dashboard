<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBCì¶©ë¶ Ã— ì˜¥ì²œì‹ ë¬¸ ë¼ì´ë¸Œ ëŒ€ì‹œë³´ë“œ</title>
<style>
:root {
  --mbc-blue: #003087;
  --mbc-light: #1a4fa0;
  --ok-green: #2d5016;
  --ok-light: #3d7020;
  --bg: #0f1117;
  --card: #1a1d27;
  --card-hover: #22263a;
  --text: #e4e4e7;
  --text-dim: #9ca3af;
  --border: #2a2d3a;
  --hot: #ef4444;
  --hot-bg: rgba(239,68,68,.12);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; line-height:1.6; }
a { color:inherit; text-decoration:none; }
a:hover { opacity:.85; }

.header {
  background:linear-gradient(135deg, var(--mbc-blue) 0%, var(--ok-green) 100%);
  padding:1.5rem 2rem;
  display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:.5rem;
}
.header h1 { font-size:1.4rem; font-weight:700; }
.header .meta { font-size:.8rem; opacity:.8; }

.container { max-width:1400px; margin:0 auto; padding:1rem; }

/* Trending */
.trending { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1rem; margin-bottom:1.5rem; }
.trend-card {
  background:var(--card); border:1px solid var(--border); border-radius:12px;
  padding:1.2rem; position:relative; transition:background .2s;
}
.trend-card:hover { background:var(--card-hover); }
.trend-card.hot { border-color:var(--hot); background:var(--hot-bg); }
.hot-badge { background:var(--hot); color:#fff; font-size:.7rem; padding:2px 8px; border-radius:20px; font-weight:700; }
.trend-title { font-size:.95rem; font-weight:600; margin:.5rem 0; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
.trend-stats { display:flex; gap:1rem; font-size:.8rem; color:var(--text-dim); }
.trend-delta { color:#22c55e; font-weight:600; }

/* Main grid */
.main { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; }
@media(max-width:768px) { .main { grid-template-columns:1fr; } }

.panel {
  background:var(--card); border:1px solid var(--border); border-radius:12px; overflow:hidden;
}
.panel-header {
  padding:1rem 1.2rem; font-weight:700; font-size:1rem;
  display:flex; align-items:center; gap:.5rem;
}
.panel-header.mbc { background:var(--mbc-blue); }
.panel-header.ok { background:var(--ok-green); }

.video-item {
  padding:1rem 1.2rem; border-bottom:1px solid var(--border); transition:background .15s;
}
.video-item:hover { background:var(--card-hover); }
.video-title { font-weight:600; font-size:.9rem; margin-bottom:.3rem; }
.video-meta { font-size:.75rem; color:var(--text-dim); margin-bottom:.5rem; }
.comment {
  background:rgba(255,255,255,.04); border-radius:8px; padding:.5rem .7rem; margin:.3rem 0; font-size:.82rem;
}
.comment-author { font-weight:600; color:var(--mbc-light); font-size:.75rem; }
.comment-text { margin-top:.15rem; }

.post-item {
  padding:.9rem 1.2rem; border-bottom:1px solid var(--border); transition:background .15s;
}
.post-item:hover { background:var(--card-hover); }
.post-title { font-weight:600; font-size:.9rem; margin-bottom:.2rem; }
.post-meta { font-size:.75rem; color:var(--text-dim); display:flex; gap:.8rem; flex-wrap:wrap; }
.post-preview { font-size:.8rem; color:var(--text-dim); margin-top:.3rem; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }

.empty { padding:2rem; text-align:center; color:var(--text-dim); }
.loading { padding:3rem; text-align:center; color:var(--text-dim); }
.loading::after { content:''; display:inline-block; width:20px; height:20px; border:2px solid var(--text-dim); border-top-color:transparent; border-radius:50%; animation:spin .8s linear infinite; margin-left:.5rem; vertical-align:middle; }
@keyframes spin { to { transform:rotate(360deg); } }

.badge { display:inline-block; font-size:.65rem; padding:1px 6px; border-radius:10px; font-weight:600; }
.badge-new { background:#3b82f6; color:#fff; }
.badge-hot { background:var(--hot); color:#fff; }
.badge-comments { background:#8b5cf6; color:#fff; }

footer { text-align:center; padding:2rem; font-size:.75rem; color:var(--text-dim); }
</style>
</head>
<body>

<div class="header">
  <h1>ğŸ“º MBCì¶©ë¶ Ã— ğŸ“° ì˜¥ì²œì‹ ë¬¸ ë¼ì´ë¸Œ ëŒ€ì‹œë³´ë“œ</h1>
  <div class="meta">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">ë¡œë”©ì¤‘...</span> Â· 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨</div>
</div>

<div class="container">
  <section class="trending" id="trending">
    <div class="loading">ê¸‰ìƒìŠ¹ ë¡œë”©ì¤‘</div>
  </section>

  <section class="main">
    <div class="panel">
      <div class="panel-header mbc">ğŸ“º MBCì¶©ë¶ ì‡¼ì¸  ëŒ“ê¸€</div>
      <div id="youtube"><div class="loading">YouTube ë°ì´í„° ë¡œë”©ì¤‘</div></div>
    </div>
    <div class="panel">
      <div class="panel-header ok">ğŸ“° ì˜¥ì²œì‹ ë¬¸ ì—¬ë¡ ê´‘ì¥</div>
      <div id="okinews"><div class="loading">ì˜¥ì²œì‹ ë¬¸ ë°ì´í„° ë¡œë”©ì¤‘</div></div>
    </div>
  </section>
</div>

<footer>MBCì¶©ë¶ Ã— ì˜¥ì²œì‹ ë¬¸ ëŒ€ì‹œë³´ë“œ Â· ë°ì´í„°ëŠ” GitHub Actionsë¡œ 4ì‹œê°„ë§ˆë‹¤ ìë™ ìˆ˜ì§‘ë©ë‹ˆë‹¤</footer>

<script>
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

function timeAgo(d) {
  if (!d) return '';
  const now = new Date();
  const t = new Date(d);
  const diff = (now - t) / 1000;
  if (diff < 60) return 'ë°©ê¸ˆ ì „';
  if (diff < 3600) return Math.floor(diff/60) + 'ë¶„ ì „';
  if (diff < 86400) return Math.floor(diff/3600) + 'ì‹œê°„ ì „';
  return Math.floor(diff/86400) + 'ì¼ ì „';
}

function fmt(n) {
  if (!n) return '0';
  if (n >= 10000) return (n/10000).toFixed(1) + 'ë§Œ';
  if (n >= 1000) return (n/1000).toFixed(1) + 'K';
  return n.toLocaleString();
}

async function load(url) {
  try {
    const r = await fetch(url + '?t=' + Date.now());
    return await r.json();
  } catch(e) {
    console.error('Fetch error:', url, e);
    return null;
  }
}

async function render() {
  const [yt, ok, tr] = await Promise.all([
    load('data/youtube.json'),
    load('data/okinews.json'),
    load('data/trending.json'),
  ]);

  // Update time
  const times = [yt?.collected_at, ok?.collected_at, tr?.collected_at].filter(Boolean);
  if (times.length) {
    const latest = times.sort().pop();
    $('#lastUpdate').textContent = new Date(latest).toLocaleString('ko-KR') + ' (' + timeAgo(latest) + ')';
  }

  // Trending
  if (tr?.items?.length) {
    $('#trending').innerHTML = tr.items.slice(0,3).map(item => `
      <div class="trend-card ${item.hot ? 'hot' : ''}">
        ${item.hot ? '<span class="hot-badge">ğŸ”¥ ê¸‰ìƒìŠ¹</span>' : ''}
        <div class="trend-title"><a href="${item.url}" target="_blank">${esc(item.title)}</a></div>
        <div class="trend-stats">
          <span>ğŸ‘€ ${fmt(item.view_count)}</span>
          ${item.view_delta > 0 ? `<span class="trend-delta">â–² ${fmt(item.view_delta)}</span>` : ''}
          <span>ğŸ’¬ ${item.comment_count || 0}</span>
          <span style="opacity:.6">${esc(item.channel || '')}</span>
        </div>
      </div>
    `).join('');
  } else {
    $('#trending').innerHTML = '<div class="empty">ê¸‰ìƒìŠ¹ ë°ì´í„° ì—†ìŒ</div>';
  }

  // YouTube
  if (yt?.videos?.length) {
    $('#youtube').innerHTML = yt.videos.map(v => `
      <div class="video-item">
        <div class="video-title"><a href="${v.url}" target="_blank">${esc(v.title)}</a></div>
        <div class="video-meta">
          ${esc(v.channel || '')} Â· ğŸ‘€ ${fmt(v.view_count)} Â· ğŸ’¬ ${v.comment_count || 0}
          ${v.upload_date ? ' Â· ' + v.upload_date : ''}
        </div>
        ${(v.comments||[]).slice(0,3).map(c => `
          <div class="comment">
            <div class="comment-author">${esc(c.author)}${c.like_count ? ' Â· â¤ï¸ '+c.like_count : ''}</div>
            <div class="comment-text">${esc(c.text)}</div>
          </div>
        `).join('')}
      </div>
    `).join('');
  } else {
    $('#youtube').innerHTML = '<div class="empty">YouTube ë°ì´í„° ì—†ìŒ</div>';
  }

  // Okinews
  if (ok?.posts?.length) {
    $('#okinews').innerHTML = ok.posts.map(p => {
      const isNew = p.date && (new Date() - new Date(p.date)) < 2*86400000;
      const isHot = p.views > 1000;
      return `
        <div class="post-item">
          <div class="post-title">
            <a href="${p.url}" target="_blank">${esc(p.title)}</a>
            ${isNew ? '<span class="badge badge-new">NEW</span>' : ''}
            ${isHot ? '<span class="badge badge-hot">HOT</span>' : ''}
            ${p.comment_count ? '<span class="badge badge-comments">ğŸ’¬'+p.comment_count+'</span>' : ''}
          </div>
          <div class="post-meta">
            <span>âœï¸ ${esc(p.author || 'ìµëª…')}</span>
            <span>ğŸ“… ${p.date || ''}</span>
            <span>ğŸ‘€ ${fmt(p.views)}</span>
          </div>
          ${p.preview ? '<div class="post-preview">'+esc(p.preview)+'</div>' : ''}
        </div>
      `;
    }).join('');
  } else {
    $('#okinews').innerHTML = '<div class="empty">ì˜¥ì²œì‹ ë¬¸ ë°ì´í„° ì—†ìŒ</div>';
  }
}

function esc(s) {
  if (!s) return '';
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

render();
setInterval(render, 5 * 60 * 1000);
</script>
</body>
</html>
